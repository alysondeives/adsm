#!/usr/bin/env atf-sh

GMAC_INSTALL_DIR=@CMAKE_INSTALL_PREFIX@
GMAC_TESTS_DIR=$GMAC_INSTALL_DIR/share/gmac
GMAC_LIB_DIR=$GMAC_INSTALL_DIR/lib

launch_thread_vec_add()
{
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$GMAC_LIB_DIR
    export GMAC_ROLL_SIZE=$1
    atf_check -s exit:0 -o ignore -e ignore $GMAC_TESTS_DIR/gmacThreadVecAdd
}

atf_test_case rolling1
rolling1_head()
{
    atf_set "descr" "Test gmacThreadVecAdd rolling update protocol (size 1)"
}

rolling1_body()
{
    launch_thread_vec_add 1
}

atf_test_case rolling2
rolling2_head()
{
    atf_set "descr" "Test gmacThreadVecAdd rolling update protocol (size 2)"
}

rolling2_body()
{
    launch_thread_vec_add 2
}

atf_test_case rolling4
rolling4_head()
{
    atf_set "descr" "Test gmacThreadVecAdd rolling update protocol (size 4)"
}

rolling4_body()
{
    launch_thread_vec_add 4
}

atf_test_case lazy
lazy_head()
{
    atf_set "descr" "Test gmacThreadVecAdd lazy update protocol"
}

lazy_body()
{
    launch_thread_vec_add -1
}

atf_init_test_cases()
{
    atf_add_test_case rolling1
    atf_add_test_case rolling2
    atf_add_test_case rolling4
    atf_add_test_case lazy
}

# vim:set backspace=2 tabstop=4 shiftwidth=4 textwidth=120 foldmethod=marker expandtab:
