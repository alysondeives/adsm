#!/bin/bash

set -x

CMAKE=cmake
CMAKE_HOME=`dirname $0`
SCRIPT_NAME=`basename $0`

BUILD_TYPE="Release"
USE_DBC=OFF

for i in $*
do
    case $i in
    --enable-debug)
        BUILD_TYPE="Debug"
        USE_DBC=ON
        ;;
    --enable-dbc)
        USE_DBC=ON
        ;;
    --disable-dbc)
        USE_DBC=OFF
        ;;
    --enable-tests)
        CMAKE_ARGS="${CMAKE_ARGS} -DMAKE_TESTS=ON"
        ;;
    --enable-opencl)
        CMAKE_ARGS="${CMAKE_ARGS} -DUSE_OPENCL=ON"
        ;;
    --with-opencl-include=*)
        opencl_include=`echo $i | sed 's/[-a-zA-Z0-9]*=//'`
        CMAKE_ARGS="${CMAKE_ARGS} -DOPENCL_INCLUDE=${opencl_include}"
        ;;
    --enable-doc)
        CMAKE_ARGS="${CMAKE_ARGS} -DMAKE_DOC=ON"
        ;;
    --enable-vm)
        CMAKE_ARGS="${CMAKE_ARGS} -DUSE_VM=ON"
        ;;
    --enable-vm-hostmap)
        CMAKE_ARGS="${CMAKE_ARGS} -DUSE_HOSTMAP_VM=ON"
        ;;
    --with-vm-size=*)
        size=`echo $i | sed 's/[-a-zA-Z0-9]*=//'`
        CMAKE_ARGS="${CMAKE_ARGS} -DVM_BITMAP=${size}"
        ;;
        esac
done

CMAKE_ARGS="${CMAKE_ARGS} -DUSE_DBC=${USE_DBC} -DCMAKE_BUILD_TYPE=${BUILD_TYPE}"
COMMAND="${CMAKE} ${CMAKE_ARGS} ${CMAKE_HOME}"
echo ${COMMAND} > ${SCRIPT_NAME}.log
${COMMAND}
